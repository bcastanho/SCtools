<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Generates one synthetic control for each treated unit and calculates 
   the difference between the treated and the synthetic control for each. 
   Returns a vector with outcome values for the synthetic controls, 
   a plot of average treatment effects, and if required generates placebos 
   out of the donor pool to be used in conjunction with plac.dist. 
   All arguments are the same used for dataprep in the Synth
   package, except for treated.units, treatment.time, and 
   generate.placebos."><title>Function to Apply Synthetic Controls to Multiple Treated Units — multiple.synth • SCtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Function to Apply Synthetic Controls to Multiple Treated Units — multiple.synth"><meta property="og:description" content="Generates one synthetic control for each treated unit and calculates 
   the difference between the treated and the synthetic control for each. 
   Returns a vector with outcome values for the synthetic controls, 
   a plot of average treatment effects, and if required generates placebos 
   out of the donor pool to be used in conjunction with plac.dist. 
   All arguments are the same used for dataprep in the Synth
   package, except for treated.units, treatment.time, and 
   generate.placebos."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case-study.html">SCM Case Study on Alcohol Consumption</a>
    <a class="dropdown-item" href="../articles/replicating-basque.html">Replicating the Basque Study</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcastanho/SCtools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Function to Apply Synthetic Controls to Multiple Treated Units</h1>
      <small class="dont-index">Source: <a href="https://github.com/bcastanho/SCtools/blob/HEAD/R/multiple.synth.R" class="external-link"><code>R/multiple.synth.R</code></a></small>
      <div class="d-none name"><code>multiple.synth.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates one synthetic control for each treated unit and calculates 
   the difference between the treated and the synthetic control for each. 
   Returns a vector with outcome values for the synthetic controls, 
   a plot of average treatment effects, and if required generates placebos 
   out of the donor pool to be used in conjunction with <code><a href="plac.dist.html">plac.dist</a></code>. 
   All arguments are the same used for <code><a href="https://rdrr.io/pkg/Synth/man/dataprep.html" class="external-link">dataprep</a></code> in the <code><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">Synth</a></code>
   package, except for <code>treated.units</code>, <code>treatment.time</code>, and 
   <code><a href="generate.placebos.html">generate.placebos</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">multiple.synth</span><span class="op">(</span>
  <span class="va">foo</span>,
  <span class="va">predictors</span>,
  <span class="va">predictors.op</span>,
  <span class="va">dependent</span>,
  <span class="va">unit.variable</span>,
  <span class="va">time.variable</span>,
  <span class="va">special.predictors</span>,
  <span class="va">treated.units</span>,
  <span class="va">control.units</span>,
  <span class="va">time.predictors.prior</span>,
  <span class="va">time.optimize.ssr</span>,
  <span class="va">unit.names.variable</span>,
  <span class="va">time.plot</span>,
  <span class="va">treatment.time</span>,
  gen.placebos <span class="op">=</span> <span class="cn">FALSE</span>,
  strategy <span class="op">=</span> <span class="st">"sequential"</span>,
  Sigf.ipop <span class="op">=</span> <span class="fl">5</span>
<span class="op">)</span>

<span class="fu">multiple_synth</span><span class="op">(</span>
  <span class="va">foo</span>,
  <span class="va">predictors</span>,
  <span class="va">predictors.op</span>,
  <span class="va">dependent</span>,
  <span class="va">unit.variable</span>,
  <span class="va">time.variable</span>,
  <span class="va">special.predictors</span>,
  <span class="va">treated.units</span>,
  <span class="va">control.units</span>,
  <span class="va">time.predictors.prior</span>,
  <span class="va">time.optimize.ssr</span>,
  <span class="va">unit.names.variable</span>,
  <span class="va">time.plot</span>,
  <span class="va">treatment.time</span>,
  gen.placebos <span class="op">=</span> <span class="cn">FALSE</span>,
  strategy <span class="op">=</span> <span class="st">"sequential"</span>,
  Sigf.ipop <span class="op">=</span> <span class="fl">5</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>foo</dt>
<dd><p>Dataframe with the panel data.</p></dd>
<dt>predictors</dt>
<dd><p>Vector of column numbers or column-name character strings 
that identifies the predictors' columns. All predictors have to be numeric.</p></dd>
<dt>predictors.op</dt>
<dd><p>A character string identifying the method (operator) 
to be used on the predictors. Default is <code>mean</code>.</p></dd>
<dt>dependent</dt>
<dd><p>The column number or a string with the column name that 
corresponds to the dependent variable.</p></dd>
<dt>unit.variable</dt>
<dd><p>The column number or a string with the column name 
that identifies unit numbers. The variable must be numeric.</p></dd>
<dt>time.variable</dt>
<dd><p>The column number or a string with the column name 
that identifies the period (time) data. The variable must be numeric.</p></dd>
<dt>special.predictors</dt>
<dd><p>A list object identifying additional predictors and 
their pre-treatment years and operators.</p></dd>
<dt>treated.units</dt>
<dd><p>A vector identifying the <code>unit.variable</code> numbers of 
the treated units.</p></dd>
<dt>control.units</dt>
<dd><p>A vector identifying the <code>unit.variable</code> numbers of 
the control units.</p></dd>
<dt>time.predictors.prior</dt>
<dd><p>A numeric vector identifying the pretreatment 
periods over which the values for the outcome predictors should be averaged.</p></dd>
<dt>time.optimize.ssr</dt>
<dd><p>A numeric vector identifying the periods of the 
dependent variable over which the loss function should be minimized 
between each treated unit and its synthetic control.</p></dd>
<dt>unit.names.variable</dt>
<dd><p>The column number or string with column name 
identifying the variable with units' names. The variable must be a character.</p></dd>
<dt>time.plot</dt>
<dd><p>A vector identifying the periods over which results are 
to be plotted with <code><a href="https://rdrr.io/pkg/Synth/man/path.plot.html" class="external-link">path.plot</a></code></p></dd>
<dt>treatment.time</dt>
<dd><p>A numeric value with the value in <code>time.variable</code>
that marks the intervention.</p></dd>
<dt>gen.placebos</dt>
<dd><p>Logical. Whether a placebo (a synthetic control) 
for each unit in the donor pool should be constructed. Will increase 
computation time.</p></dd>
<dt>strategy</dt>
<dd><p>The processing method you wish to use 
"sequential" or "multiprocess". Use "multiprocess" to parallelize operations
 and reduce computing time. Default is <code>sequential</code>.</p></dd>
<dt>Sigf.ipop</dt>
<dd><p>The Precision setting for the ipop optimization routine. 
Default of 5.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Data frame. Each column contains the outcome values for every 
time-point for one unit or its synthetic control. The last column contains 
the time-points.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function runs <code><a href="https://rdrr.io/pkg/Synth/man/dataprep.html" class="external-link">dataprep</a></code> and <code><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">synth</a></code> 
   for each unit identified in <code>treated.units</code>. It saves the vector with 
   predicted values for each synthetic control, to be used in estimating 
   average treatment effects in applications of Synthetic Controls for 
   multiple treated units.</p>   
<p>For further details on the arguments, see the documentation of 
   <code><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">Synth</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Using the toy data from 'Synth':</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain" class="external-link">Synth</a></span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">synth.data</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">multi</span> <span class="op">&lt;-</span> <span class="fu">multiple.synth</span><span class="op">(</span>foo <span class="op">=</span> <span class="va">synth.data</span>,</span>
<span class="r-in">                       predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span>,</span>
<span class="r-in">                       predictors.op <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span class="r-in">                       dependent <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span class="r-in">                       unit.variable <span class="op">=</span> <span class="st">"unit.num"</span>,</span>
<span class="r-in">                       time.variable <span class="op">=</span> <span class="st">"year"</span>,</span>
<span class="r-in">                       treatment.time <span class="op">=</span> <span class="fl">1990</span>,</span>
<span class="r-in">                       special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fl">1991</span>, <span class="st">"mean"</span><span class="op">)</span></span>
<span class="r-in">                       <span class="op">)</span>,</span>
<span class="r-in">                       treated.units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">7</span><span class="op">)</span>,</span>
<span class="r-in">                       control.units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29</span>, <span class="fl">13</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span class="r-in">                       time.predictors.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1989</span><span class="op">)</span>,</span>
<span class="r-in">                       time.optimize.ssr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span>,</span>
<span class="r-in">                       unit.names.variable <span class="op">=</span> <span class="st">"name"</span>,</span>
<span class="r-in">                       time.plot <span class="op">=</span> <span class="fl">1984</span><span class="op">:</span><span class="fl">1996</span>, gen.placebos <span class="op">=</span>  <span class="cn">FALSE</span>, </span>
<span class="r-in">                       Sigf.ipop <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 5.60058 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.0001064523 0.9998935 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.1728629 0.8270615 7.56699e-05 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 80.81988 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.002266006 0.004655154 0.9930788 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="co">## Plot with the average path of the treated units and the average of their</span></span>
<span class="r-in"><span class="co">## respective synthetic controls:</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">multi</span><span class="op">$</span><span class="va">p</span></span>
<span class="r-plt img"><img src="multiple.synth-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Bruno Castanho Silva, Michael DeWitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

