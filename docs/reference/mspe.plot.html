<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Plots the post/pre-treatment mean square prediction error ratio 
    for the treated unit and placebos."><title>Plot the post/pre-treatment MSPE ratio — mspe.plot • SCtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot the post/pre-treatment MSPE ratio — mspe.plot"><meta property="og:description" content="Plots the post/pre-treatment mean square prediction error ratio 
    for the treated unit and placebos."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SCtools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/case-study.html">SCM Case Study on Alcohol Consumption</a>
    <a class="dropdown-item" href="../articles/replicating-basque.html">Replicating the Basque Study</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcastanho/SCtools/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Plot the post/pre-treatment MSPE ratio</h1>
      <small class="dont-index">Source: <a href="https://github.com/bcastanho/SCtools/blob/HEAD/R/mspe.plot.R" class="external-link"><code>R/mspe.plot.R</code></a></small>
      <div class="d-none name"><code>mspe.plot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Plots the post/pre-treatment mean square prediction error ratio 
    for the treated unit and placebos.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">mspe.plot</span><span class="op">(</span>
  <span class="va">tdf</span>,
  discard.extreme <span class="op">=</span> <span class="cn">FALSE</span>,
  mspe.limit <span class="op">=</span> <span class="fl">20</span>,
  plot.hist <span class="op">=</span> <span class="cn">FALSE</span>,
  title <span class="op">=</span> <span class="cn">NULL</span>,
  xlab <span class="op">=</span> <span class="st">"Post/Pre MSPE ratio"</span>,
  ylab <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span>

<span class="fu">mspe_plot</span><span class="op">(</span>
  <span class="va">tdf</span>,
  discard.extreme <span class="op">=</span> <span class="cn">FALSE</span>,
  mspe.limit <span class="op">=</span> <span class="fl">20</span>,
  plot.hist <span class="op">=</span> <span class="cn">FALSE</span>,
  title <span class="op">=</span> <span class="cn">NULL</span>,
  xlab <span class="op">=</span> <span class="st">"Post/Pre MSPE ratio"</span>,
  ylab <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>tdf</dt>
<dd><p>An object constructed by <code><a href="generate.placebos.html">generate.placebos</a></code>.</p></dd>
<dt>discard.extreme</dt>
<dd><p>Logical. Whether or not placebos with high 
pre-treatement MSPE should be excluded from the plot.</p></dd>
<dt>mspe.limit</dt>
<dd><p>Numerical. Used if <code>discard.extreme</code> is <code>TRUE</code>. 
It indicates how many times the pretreatment MSPE of a placebo should 
be higher than that of the treated unit to be considered extreme and 
discarded. Default is <code>20</code>.</p></dd>
<dt>plot.hist</dt>
<dd><p>Logical. If <code>FALSE</code>, a dotplot with each unit name 
and its post/pre treatment MSPE ratio is produced. If <code>TRUE</code>, 
a histogram is produced, with the frequency of each ratio. 
Should be set to <code>TRUE</code> when there are many controls, to make 
visualization easier.</p></dd>
<dt>title</dt>
<dd><p>Character. Optional. Title of the plot.</p></dd>
<dt>xlab</dt>
<dd><p>Character. Optional. Label of the x axis.</p></dd>
<dt>ylab</dt>
<dd><p>Character. Optional. Label of the y axis.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Post/pre-treatement mean square prediction error ratio is the 
    difference between the observed outcome of a unit and its synthetic 
    control, before and after treatement. A higher ratio means a small 
    pretreatment prediction error (a good synthetic control), and a high 
    post-treatment MSPE, meaning a large difference between the unit and 
    its synthetic control after the intervention. By calculating this ratio 
    for all placebos, the test can be interpreted as looking at how likely 
    the result obtained for a single treated case with a synthetic control 
    analysis could have occurred by chance given no treatement. 
    For more detailed description, see Abadie, Diamond, and Hainmueller (2011, 2014).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Abadie, A., Diamond, A., Hainmueller, J. (2014). 
  Comparative Politics and the Synthetic Control Method. 
  American Journal of Political Science Forthcoming 2014.</p>
<p>Synthetic : An R Package for Synthetic Control Methods in Comparative 
   Case Studies. Journal of Statistical Software 42 (13) 1–17.</p>
<p>Abadie, A., Diamond, A., Hainmueller, J. (2011). Synth: An R Package for 
   Synthetic Control Methods in Comparative Case Studies. 
   Journal of Statistical Software 42 (13) 1–17.</p>
<p>Abadie A, Diamond A, Hainmueller J (2010). Synthetic Control Methods for 
   Comparative Case Studies: Estimating the Effect of California's Tobacco 
   Control Program. Journal of the American Statistical Association 
   105 (490) 493–505.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="generate.placebos.html">generate.placebos</a></code>, <code><a href="mspe.test.html">mspe.test</a></code>, 
    <code><a href="plot_placebos.html">plot_placebos</a></code>, <code><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">synth</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Example with toy data from Synth</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain" class="external-link">Synth</a></span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Load the simulated data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">synth.data</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Execute dataprep to produce the necessary matrices for synth</span></span>
<span class="r-in"><span class="va">dataprep.out</span><span class="op">&lt;-</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html" class="external-link">dataprep</a></span><span class="op">(</span></span>
<span class="r-in">    foo <span class="op">=</span> <span class="va">synth.data</span>,</span>
<span class="r-in">    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span>,</span>
<span class="r-in">    predictors.op <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span class="r-in">    dependent <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span class="r-in">    unit.variable <span class="op">=</span> <span class="st">"unit.num"</span>,</span>
<span class="r-in">    time.variable <span class="op">=</span> <span class="st">"year"</span>,</span>
<span class="r-in">    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fl">1991</span>, <span class="st">"mean"</span><span class="op">)</span></span>
<span class="r-in">    <span class="op">)</span>,</span>
<span class="r-in">    treatment.identifier <span class="op">=</span> <span class="fl">7</span>,</span>
<span class="r-in">    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29</span>, <span class="fl">2</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span class="r-in">    time.predictors.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1989</span><span class="op">)</span>,</span>
<span class="r-in">    time.optimize.ssr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span>,</span>
<span class="r-in">    unit.names.variable <span class="op">=</span> <span class="st">"name"</span>,</span>
<span class="r-in">    time.plot <span class="op">=</span> <span class="fl">1984</span><span class="op">:</span><span class="fl">1996</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># run the synth command to create the synthetic control</span></span>
<span class="r-in"><span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">synth</a></span><span class="op">(</span><span class="va">dataprep.out</span>, Sigf.ipop<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 31.03738 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.2058833 0.7941167 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.3616606 0.3220655 0.3147483 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate.placebos.html">generate.placebos</a></span><span class="op">(</span><span class="va">dataprep.out</span>,<span class="va">synth.out</span>, Sigf.ipop <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 25.21919 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.5127917 0.49214 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 212.8446 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.99648 0.003519969 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.4851494 0.5144103 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 94.81057 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.5059424 0.5518736 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> New names:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...1`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...2`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...3`</span>
<span class="r-in"><span class="co">## Test how extreme was the observed treatment effect given the placebos:</span></span>
<span class="r-in"><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="mspe.test.html">mspe.test</a></span><span class="op">(</span><span class="va">tdf</span><span class="op">)</span></span>
<span class="r-in"><span class="va">ratio</span><span class="op">$</span><span class="va">p.val</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.25</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">mspe.plot</span><span class="op">(</span><span class="va">tdf</span>, discard.extreme <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="mspe.plot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">## Example with toy data from 'Synth'</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stanford.edu/~jhain" class="external-link">Synth</a></span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Load the simulated data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">synth.data</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Execute dataprep to produce the necessary matrices for 'Synth'</span></span>
<span class="r-in"><span class="va">dataprep.out</span><span class="op">&lt;-</span></span>
<span class="r-in">  <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/dataprep.html" class="external-link">dataprep</a></span><span class="op">(</span></span>
<span class="r-in">    foo <span class="op">=</span> <span class="va">synth.data</span>,</span>
<span class="r-in">    predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span>,</span>
<span class="r-in">    predictors.op <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span class="r-in">    dependent <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span class="r-in">    unit.variable <span class="op">=</span> <span class="st">"unit.num"</span>,</span>
<span class="r-in">    time.variable <span class="op">=</span> <span class="st">"year"</span>,</span>
<span class="r-in">    special.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span class="r-in">      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Y"</span>, <span class="fl">1991</span>, <span class="st">"mean"</span><span class="op">)</span></span>
<span class="r-in">    <span class="op">)</span>,</span>
<span class="r-in">    treatment.identifier <span class="op">=</span> <span class="fl">7</span>,</span>
<span class="r-in">    controls.identifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29</span>, <span class="fl">2</span>, <span class="fl">13</span>, <span class="fl">17</span><span class="op">)</span>,</span>
<span class="r-in">    time.predictors.prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1989</span><span class="op">)</span>,</span>
<span class="r-in">    time.optimize.ssr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span>,</span>
<span class="r-in">    unit.names.variable <span class="op">=</span> <span class="st">"name"</span>,</span>
<span class="r-in">    time.plot <span class="op">=</span> <span class="fl">1984</span><span class="op">:</span><span class="fl">1996</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># run the synth command to create the synthetic control</span></span>
<span class="r-in"><span class="va">synth.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Synth/man/synth.html" class="external-link">synth</a></span><span class="op">(</span><span class="va">dataprep.out</span>, Sigf.ipop<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 19.33618 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.2559408 0.1232918 0.3053249 0.315439 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## run the generate.placebos command to reassign treatment status</span></span>
<span class="r-in"><span class="co">## to each unit listed as control, one at a time, and generate their</span></span>
<span class="r-in"><span class="co">## synthetic versions. Sigf.ipop = 2 for faster computing time. </span></span>
<span class="r-in"><span class="co">## Increase to the default of 5 for better estimates. </span></span>
<span class="r-in"><span class="va">tdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate.placebos.html">generate.placebos</a></span><span class="op">(</span><span class="va">dataprep.out</span>,<span class="va">synth.out</span>, Sigf.ipop <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 89.19944 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.02942986 0.9705701 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.2112062 0.4493425 0.3394498 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 3209.434 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.9858452 0.00739644 0.006758148 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 357.7047 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8.2e-09 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.1678859 0.03788081 0.7942333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> X1, X0, Z1, Z0 all come directly from dataprep object.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  searching for synthetic control unit  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> **************** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSPE (LOSS V): 91.49109 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.v:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.6683888 0.3316112 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> solution.w:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.1545103 0.2152758 0.6299727 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> New names:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...1`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...2`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...3`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> `w.weight` -&gt; `w.weight...4`</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Test how extreme was the observed treatment effect given the placebos:</span></span>
<span class="r-in"><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="mspe.test.html">mspe.test</a></span><span class="op">(</span><span class="va">tdf</span><span class="op">)</span></span>
<span class="r-in"><span class="va">ratio</span><span class="op">$</span><span class="va">p.val</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">mspe.plot</span><span class="op">(</span><span class="va">tdf</span>, discard.extreme <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-plt img"><img src="mspe.plot-2.png" alt="" width="700" height="433"></span>
<span class="r-in">   </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Bruno Castanho Silva, Michael DeWitt.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

